<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="cache-control" content="no-cache"/>
    <title>Streaming</title>
    <!-- Video.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js/dist/video-js.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@silvermine/videojs-chromecast@1.2.0/dist/silvermine-videojs-chromecast.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/videojs-hls-quality-selector@1.1.0/dist/videojs-hls-quality-selector.min.css" rel="stylesheet">

    <!-- Video.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/video.js/dist/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@videojs/http-streaming/dist/videojs-http-streaming.min.js"></script>
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <script src="https://cdn.jsdelivr.net/npm/@silvermine/videojs-chromecast/dist/silvermine-videojs-chromecast.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs-hls-quality-selector/dist/videojs-hls-quality-selector.min.js"></script>

    <style>
        body { margin: 0 auto; padding: 0; background: #EEE; overflow: hidden; }
        #titulo { font: bold 24px/36px Arial, sans-serif; color: #000; margin: 40px auto 10px auto; display: none; text-shadow: #FFF 2px 2px 0; }
        #descrip { font: 13px/20px Arial, sans-serif; margin: 15px auto; display: none; text-shadow: #FFF 1px 1px 0; }
        .vjs-poster { background-size: cover !important; }
    </style>
</head>
<body>
    <h2 id="titulo"></h2>
    <h3 id="descrip"></h3>

    <video id="live" class="video-js vjs-big-play-centered">
        <!-- La URL segura generada en PHP -->
        <source src="https://stream.arcast.ar/c8mdp/ngrp:c8mdp_all/playlist.m3u8?wowzatokenendtime=1733010060&wowzatokenstarttime=0&wowzatokenhash=lus3J_ZpAuwm4N9u4_tvAAKkM3S8muFakr8yNgx2peA=" type="application/x-mpegURL">
    </video>

    <script>
        videojs.addLanguage('en', {
            "The media could not be loaded, either because the server or network failed or because the format is not supported.": 
            "No hay emisión en vivo en este momento."
        });

        var options = {
            controls: true,
            liveui: true,
            preload: 'auto',
            fluid: true,
		 poster: "https://arcast.com.ar/c8mdp/c8mdp_poster.jpg",
            autoplay: false,
            muted: false,
            techOrder: ['chromecast', 'html5']
        };

        (function(window, videojs) {
            var player = window.player = videojs('live', options);

            player.ready(function() {
                // Activa el plugin de selección de calidad
                this.hlsQualitySelector({
                    displayCurrentQuality: true // Muestra la calidad actual en la UI
                });
            });

            // Habilita Chromecast
            player.chromecast();
        }(window, window.videojs));

        if (window === window.top) {
            document.getElementById("titulo").style.display = "block";
            document.getElementById("descrip").style.display = "block";
            document.body.style.width = "70%";
        } else {
            window.addEventListener("message", function(evt) {
                switch (evt.data) {
                    case "play":
                        player().play();
                        break;
                    case "pause":
                        player().pause();
                        break;
                }
            });
        }
    </script>
</body>
</html>
